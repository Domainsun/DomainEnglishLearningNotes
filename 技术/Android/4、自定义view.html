<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>自定义View | Domainsun的英语自学笔记</title>
    <meta name="generator" content="VuePress 1.9.10">
    
    <meta name="description" content="英语学习手册,语法,英语学习方法,英语工具资源,背单词方法">
    
    <link rel="preload" href="/assets/css/0.styles.0cf1db6b.css" as="style"><link rel="preload" href="/assets/js/app.75a2606c.js" as="script"><link rel="preload" href="/assets/js/3.7b5fc60a.js" as="script"><link rel="preload" href="/assets/js/1.84786563.js" as="script"><link rel="preload" href="/assets/js/69.141e8266.js" as="script"><link rel="prefetch" href="/assets/js/10.f59203a1.js"><link rel="prefetch" href="/assets/js/100.010d14e1.js"><link rel="prefetch" href="/assets/js/101.8278cbc2.js"><link rel="prefetch" href="/assets/js/102.331de778.js"><link rel="prefetch" href="/assets/js/103.6ad07d2a.js"><link rel="prefetch" href="/assets/js/104.ccde0b66.js"><link rel="prefetch" href="/assets/js/105.b965572a.js"><link rel="prefetch" href="/assets/js/106.77edbdf3.js"><link rel="prefetch" href="/assets/js/107.3027eb1a.js"><link rel="prefetch" href="/assets/js/108.17396dbc.js"><link rel="prefetch" href="/assets/js/109.7eae1616.js"><link rel="prefetch" href="/assets/js/11.3ea8a968.js"><link rel="prefetch" href="/assets/js/110.889c70dd.js"><link rel="prefetch" href="/assets/js/111.5f5759e6.js"><link rel="prefetch" href="/assets/js/112.46632438.js"><link rel="prefetch" href="/assets/js/113.e52a8dff.js"><link rel="prefetch" href="/assets/js/114.4cf8ce8b.js"><link rel="prefetch" href="/assets/js/115.ee1fde1b.js"><link rel="prefetch" href="/assets/js/116.c5b5c50d.js"><link rel="prefetch" href="/assets/js/117.0165856e.js"><link rel="prefetch" href="/assets/js/118.25c54d46.js"><link rel="prefetch" href="/assets/js/119.f4c39a82.js"><link rel="prefetch" href="/assets/js/12.778a3f26.js"><link rel="prefetch" href="/assets/js/120.df02ecf3.js"><link rel="prefetch" href="/assets/js/121.bf7dda66.js"><link rel="prefetch" href="/assets/js/122.b6f17cbf.js"><link rel="prefetch" href="/assets/js/123.553009f5.js"><link rel="prefetch" href="/assets/js/124.78dd2967.js"><link rel="prefetch" href="/assets/js/125.b956d8f9.js"><link rel="prefetch" href="/assets/js/126.60958c96.js"><link rel="prefetch" href="/assets/js/127.cf7b03ea.js"><link rel="prefetch" href="/assets/js/128.fd32762b.js"><link rel="prefetch" href="/assets/js/129.4be5e017.js"><link rel="prefetch" href="/assets/js/130.af921229.js"><link rel="prefetch" href="/assets/js/131.d32a3073.js"><link rel="prefetch" href="/assets/js/132.9c6555c3.js"><link rel="prefetch" href="/assets/js/133.f365cd5b.js"><link rel="prefetch" href="/assets/js/134.7fa44463.js"><link rel="prefetch" href="/assets/js/135.5b24b8d3.js"><link rel="prefetch" href="/assets/js/136.cfb85c3b.js"><link rel="prefetch" href="/assets/js/137.72bc5461.js"><link rel="prefetch" href="/assets/js/138.b57eb0b6.js"><link rel="prefetch" href="/assets/js/139.a131b135.js"><link rel="prefetch" href="/assets/js/140.fcba23ba.js"><link rel="prefetch" href="/assets/js/141.4c7c54f2.js"><link rel="prefetch" href="/assets/js/142.d262cae7.js"><link rel="prefetch" href="/assets/js/143.c8a89b4f.js"><link rel="prefetch" href="/assets/js/144.bfd9e69e.js"><link rel="prefetch" href="/assets/js/145.8d649578.js"><link rel="prefetch" href="/assets/js/146.f45e0061.js"><link rel="prefetch" href="/assets/js/147.4e7518db.js"><link rel="prefetch" href="/assets/js/15.cda47e54.js"><link rel="prefetch" href="/assets/js/16.fb57443f.js"><link rel="prefetch" href="/assets/js/17.c9efba56.js"><link rel="prefetch" href="/assets/js/18.e1216b3c.js"><link rel="prefetch" href="/assets/js/19.14a882c9.js"><link rel="prefetch" href="/assets/js/2.8f91be42.js"><link rel="prefetch" href="/assets/js/20.019fe389.js"><link rel="prefetch" href="/assets/js/21.f28e4a2e.js"><link rel="prefetch" href="/assets/js/22.faa48535.js"><link rel="prefetch" href="/assets/js/23.363c05b4.js"><link rel="prefetch" href="/assets/js/24.a81f0683.js"><link rel="prefetch" href="/assets/js/25.e1793479.js"><link rel="prefetch" href="/assets/js/26.14af8cf8.js"><link rel="prefetch" href="/assets/js/27.1a97081c.js"><link rel="prefetch" href="/assets/js/28.d4929efd.js"><link rel="prefetch" href="/assets/js/29.300d28f7.js"><link rel="prefetch" href="/assets/js/30.6572996b.js"><link rel="prefetch" href="/assets/js/31.d7b50c38.js"><link rel="prefetch" href="/assets/js/32.f827013d.js"><link rel="prefetch" href="/assets/js/33.11143a07.js"><link rel="prefetch" href="/assets/js/34.9c9d7d30.js"><link rel="prefetch" href="/assets/js/35.4ba4fe5f.js"><link rel="prefetch" href="/assets/js/36.bb76d201.js"><link rel="prefetch" href="/assets/js/37.8d894fd0.js"><link rel="prefetch" href="/assets/js/38.eab8f7b1.js"><link rel="prefetch" href="/assets/js/39.a14804b8.js"><link rel="prefetch" href="/assets/js/4.f87653e8.js"><link rel="prefetch" href="/assets/js/40.5da7dcfd.js"><link rel="prefetch" href="/assets/js/41.8ef5d93d.js"><link rel="prefetch" href="/assets/js/42.6fb79061.js"><link rel="prefetch" href="/assets/js/43.82a5af19.js"><link rel="prefetch" href="/assets/js/44.59aed4d3.js"><link rel="prefetch" href="/assets/js/45.f50d48e1.js"><link rel="prefetch" href="/assets/js/46.93a8cfb2.js"><link rel="prefetch" href="/assets/js/47.3c251ced.js"><link rel="prefetch" href="/assets/js/48.38b10cbe.js"><link rel="prefetch" href="/assets/js/49.a073a187.js"><link rel="prefetch" href="/assets/js/5.4ffa01f2.js"><link rel="prefetch" href="/assets/js/50.1f89d19c.js"><link rel="prefetch" href="/assets/js/51.0378ab98.js"><link rel="prefetch" href="/assets/js/52.e3720aef.js"><link rel="prefetch" href="/assets/js/53.36161899.js"><link rel="prefetch" href="/assets/js/54.721004f5.js"><link rel="prefetch" href="/assets/js/55.d307aecb.js"><link rel="prefetch" href="/assets/js/56.d54c9c15.js"><link rel="prefetch" href="/assets/js/57.b6b7c537.js"><link rel="prefetch" href="/assets/js/58.869601b8.js"><link rel="prefetch" href="/assets/js/59.508824bf.js"><link rel="prefetch" href="/assets/js/6.c55d2fe6.js"><link rel="prefetch" href="/assets/js/60.70580ecb.js"><link rel="prefetch" href="/assets/js/61.008c3a06.js"><link rel="prefetch" href="/assets/js/62.06c5d100.js"><link rel="prefetch" href="/assets/js/63.e9bf2425.js"><link rel="prefetch" href="/assets/js/64.bcfa5861.js"><link rel="prefetch" href="/assets/js/65.0035a0c3.js"><link rel="prefetch" href="/assets/js/66.36d619f7.js"><link rel="prefetch" href="/assets/js/67.8dc67b33.js"><link rel="prefetch" href="/assets/js/68.fbf4d68c.js"><link rel="prefetch" href="/assets/js/7.647429c8.js"><link rel="prefetch" href="/assets/js/70.9780fe09.js"><link rel="prefetch" href="/assets/js/71.404ad4d3.js"><link rel="prefetch" href="/assets/js/72.d583bcc1.js"><link rel="prefetch" href="/assets/js/73.8852d25b.js"><link rel="prefetch" href="/assets/js/74.5cbcad7b.js"><link rel="prefetch" href="/assets/js/75.b8b8570e.js"><link rel="prefetch" href="/assets/js/76.92df56e2.js"><link rel="prefetch" href="/assets/js/77.9cb135eb.js"><link rel="prefetch" href="/assets/js/78.d1317e33.js"><link rel="prefetch" href="/assets/js/79.81147cba.js"><link rel="prefetch" href="/assets/js/8.19d34e47.js"><link rel="prefetch" href="/assets/js/80.c430ba95.js"><link rel="prefetch" href="/assets/js/81.65a9abb9.js"><link rel="prefetch" href="/assets/js/82.50f6663a.js"><link rel="prefetch" href="/assets/js/83.d4ce0001.js"><link rel="prefetch" href="/assets/js/84.8c5964db.js"><link rel="prefetch" href="/assets/js/85.1e6f2c17.js"><link rel="prefetch" href="/assets/js/86.f72fb8cf.js"><link rel="prefetch" href="/assets/js/87.572422a3.js"><link rel="prefetch" href="/assets/js/88.1c40aa4f.js"><link rel="prefetch" href="/assets/js/89.eaa1e3a6.js"><link rel="prefetch" href="/assets/js/9.2a47aba7.js"><link rel="prefetch" href="/assets/js/90.a210f38b.js"><link rel="prefetch" href="/assets/js/91.976bc16f.js"><link rel="prefetch" href="/assets/js/92.826a2480.js"><link rel="prefetch" href="/assets/js/93.d5b0bf54.js"><link rel="prefetch" href="/assets/js/94.182d5842.js"><link rel="prefetch" href="/assets/js/95.cee6c154.js"><link rel="prefetch" href="/assets/js/96.e00cc6aa.js"><link rel="prefetch" href="/assets/js/97.d4cfb682.js"><link rel="prefetch" href="/assets/js/98.569e77cb.js"><link rel="prefetch" href="/assets/js/99.5e2fd19b.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.3c664a3a.js">
    <link rel="stylesheet" href="/assets/css/0.styles.0cf1db6b.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Domainsun的英语自学笔记</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/英语/" class="nav-link">
  英语
</a></div><div class="nav-item"><a href="/技术/" class="nav-link">
  技术
</a></div><div class="nav-item"><a href="/工具资源/" class="nav-link">
  工具资源
</a></div><div class="nav-item"><a href="/个人生活/" class="nav-link">
  个人生活
</a></div><div class="nav-item"><a href="/" class="nav-link">
  关于
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/英语/" class="nav-link">
  英语
</a></div><div class="nav-item"><a href="/技术/" class="nav-link">
  技术
</a></div><div class="nav-item"><a href="/工具资源/" class="nav-link">
  工具资源
</a></div><div class="nav-item"><a href="/个人生活/" class="nav-link">
  个人生活
</a></div><div class="nav-item"><a href="/" class="nav-link">
  关于
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>自定义View</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/%E6%8A%80%E6%9C%AF/Android/4%E3%80%81%E8%87%AA%E5%AE%9A%E4%B9%89view.html#android-view层级图" class="sidebar-link">Android View层级图</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/%E6%8A%80%E6%9C%AF/Android/4%E3%80%81%E8%87%AA%E5%AE%9A%E4%B9%89view.html#测量、布局、绘制" class="sidebar-link">测量、布局、绘制</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/%E6%8A%80%E6%9C%AF/Android/4%E3%80%81%E8%87%AA%E5%AE%9A%E4%B9%89view.html#测量方法" class="sidebar-link">测量方法</a></li><li class="sidebar-sub-header"><a href="/%E6%8A%80%E6%9C%AF/Android/4%E3%80%81%E8%87%AA%E5%AE%9A%E4%B9%89view.html#布局方法" class="sidebar-link">布局方法</a></li><li class="sidebar-sub-header"><a href="/%E6%8A%80%E6%9C%AF/Android/4%E3%80%81%E8%87%AA%E5%AE%9A%E4%B9%89view.html#绘制方法" class="sidebar-link">绘制方法</a></li></ul></li><li><a href="/%E6%8A%80%E6%9C%AF/Android/4%E3%80%81%E8%87%AA%E5%AE%9A%E4%B9%89view.html#事件分发" class="sidebar-link">事件分发</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/%E6%8A%80%E6%9C%AF/Android/4%E3%80%81%E8%87%AA%E5%AE%9A%E4%B9%89view.html#从activity分发到viewgroup" class="sidebar-link">从Activity分发到ViewGroup</a></li><li class="sidebar-sub-header"><a href="/%E6%8A%80%E6%9C%AF/Android/4%E3%80%81%E8%87%AA%E5%AE%9A%E4%B9%89view.html#从viewgroup分发到view" class="sidebar-link">从ViewGroup分发到View</a></li><li class="sidebar-sub-header"><a href="/%E6%8A%80%E6%9C%AF/Android/4%E3%80%81%E8%87%AA%E5%AE%9A%E4%B9%89view.html#事件分发伪代码" class="sidebar-link">事件分发伪代码</a></li><li class="sidebar-sub-header"><a href="/%E6%8A%80%E6%9C%AF/Android/4%E3%80%81%E8%87%AA%E5%AE%9A%E4%B9%89view.html#解决事件冲突" class="sidebar-link">解决事件冲突</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="自定义view"><a href="#自定义view" class="header-anchor">#</a> 自定义View</h1> <h2 id="android-view层级图"><a href="#android-view层级图" class="header-anchor">#</a> Android View层级图</h2> <img src="https://gitee.com/yutian_9065/img/raw/master/img/202304032145369.png"> <hr> <h2 id="测量、布局、绘制"><a href="#测量、布局、绘制" class="header-anchor">#</a> 测量、布局、绘制</h2> <p>在Android中，所有View都继承自View.java这个类，包括ViewGroup。 在View这个类中有三个方法onMeasure、onLayout、onDarw。 分别负责实现View的测量、布局、和绘制逻辑。这三个方法会在从安卓的最顶层View（DecorView）依次递归执行到最底层的子View，来完成整个页面布局的展示。</p> <p>在我们自定义View时，如果是自定义ViewGroup，则需要继承自ViewGroup或者其子类并实现这三个方法。 如果是自定义View,则需要继承自View或其子类并实现测量和绘制这两个方法。</p> <h3 id="测量方法"><a href="#测量方法" class="header-anchor">#</a> 测量方法</h3> <p>在测量方法中， 如果是自定义ViewGroup，那么要先调用每一个子view的测量方法，其中的参数是widthMeasureSpe 和 heightMeasureSpec,  这个两个参数就是父view对子view的宽高限制。 它是一个32位的int值， 前两位表示限制的模式，后30位表示宽高的值。 限制模式有三种：不限制、限制最高不能超过多少和限制具体值。 在自己的这个onMeasure方法中传进来的这两个参数也是父View传进来的。 根据父View传进来的对自己的宽高限制，再根据子View的布局参数，match,warp,具体值。 就可以得出应该给子view的widthMeasureSpe和heightMeasureSpec。 得出这个值后，调用子view的测量方法，让自View进行自我测量，会把测量结果保存在measureWidth和measureHeight这两个变量，可以通过调用子View的getMeasureWidth 和 getMeasureHeight获取.</p> <h3 id="布局方法"><a href="#布局方法" class="header-anchor">#</a> 布局方法</h3> <p>布局方法比较简单， 就是调用每一个子view的onLayout布局方法， 把这个子View相对于自身的位置参数<strong>左上右下</strong>传给它。 具体要怎么摆放子view根据需求计算得出即可。</p> <h3 id="绘制方法"><a href="#绘制方法" class="header-anchor">#</a> 绘制方法</h3> <p>绘制就是通过画笔和画布这两个对象来配合使用，完成绘制。 画笔是设置的一些公共参数， 颜色，大小，是否填充等。 而通过画布的.drawxxx这些方法就可以画具体的图形。 要注意，画复杂图形的画要用drawPath方法。 先把path组合出来再绘制。</p> <hr> <h2 id="事件分发"><a href="#事件分发" class="header-anchor">#</a> 事件分发</h2> <p>事件分发就是安卓中对事件事件处理的一套机制。 事件会从上往下从Activity页面分发到ViewGroup，再从ViewGroup分发到View。</p> <h3 id="从activity分发到viewgroup"><a href="#从activity分发到viewgroup" class="header-anchor">#</a> 从Activity分发到ViewGroup</h3> <p>事件会最先被分发到Activity的分发方法中， 在这个分发方法中，调用了phoneWindow的分发方法， phoneWindow的分发方法调用了DecorView的分发方法。 DecorView继承自FrameLayout,FrameLayout继承自ViewGroup,并且在这个继承关系中，没有重写ViewGroup的分发方法。 所以总结来说就是：<strong>Activity中的分发方法拿到事件后， 调用了DecorView这个安卓最顶层的视图组的父类的ViewGroup这个类的分发方法，这样就完成了事件从Activity分发到ViewGroup的过程。</strong></p> <h3 id="从viewgroup分发到view"><a href="#从viewgroup分发到view" class="header-anchor">#</a> 从ViewGroup分发到View</h3> <p>ViewGroup拿到事件后， 要分发给它这个容器中的每一个子View, 在它的分发方法中， 有三块核心代码处理它的分发逻辑。</p> <p>第一块代码：判断是否拦截，如果是down事件， 会清除标志位，调用自己的拦截方法。如果是其他事件会根据标志位来判断是否走拦截方法。</p> <p>第二块代码：根据第一块代码的是否拦截这个返回值， 来判断是否走第二块第二块代码。 第二块代码是循环遍历自己的每一个子view并调用它们的分发方法，把事件分发给它们。<strong>这样就把事件从视图组分发给了视图。</strong></p> <p>第三块代码：根据第二块代码子view是否处理事件的返回值，来判断是否走自己消费事件， <strong>自己消费事件是调用父类的分发方法super.dispatchTouchEvent</strong>， 因为ViewGroup的父类是View, View的分发方法中，处理的就是事件的消费， 它会先调用ouTouch方法， 根据onTouch方法的返回值， 来决定是否执行onTouchEvent方法， 在onTouchEvent方法中，就会处理点击，长按这些事件逻辑。 <strong>所以如果onTouch返回true的话， onTouchEvent就不会被执行， 点击事件就不会被执行。</strong></p> <p>**这样经过ViewGroup的分发方法后， 事件就完成了从ViewGroup分发到View的过程。 ** 每一个Android中的视图都是继承自ViewGroup或者View, 所以事件会从上往下的递归的走这个分发逻辑。</p> <h3 id="事件分发伪代码"><a href="#事件分发伪代码" class="header-anchor">#</a> 事件分发伪代码</h3> <div class="language- extra-class"><pre class="language-text"><code>View.java 分发方法（主要负责处理事件，把事件交给给自己的onTouch方法或者onTouchEvent处理）
事件如果到了View, 就不需要往下分发了， 因为没有子view。 所以View的分发方法和消费方法都是处理事件。 ViewGroup如果需要把事件交给View处理， 只需要调用这个view的分发方法。 
public boolean dispatchTouchEvent(MotionEvent event) {
 ListenerInfo li = mListenerInfo;
if (li != null &amp;&amp; li.mOnTouchListener != null
        &amp;&amp; (mViewFlags &amp; ENABLED_MASK) == ENABLED
        &amp;&amp; li.mOnTouchListener.onTouch(this, event)) {
    result = true;
}

if (!result &amp;&amp; onTouchEvent(event)) {
    result = true;
 }
 }

View.java的分发方法如上，调用onTouch，onTouch返回ture，则onTouchEvent不执行，false则执行。 
在onTouchEvent中的up事件通过performClick处理了点击事件的回调。 

所以， onTouch,onTouchEvent, onClick 的执行顺序是依次的。 
并且， 这三个方法都不一定会执行， 因为必须走View.java的分发方法才会走这些逻辑， 如果分发方法被复写并且没有执行super.分发方法， 这块的逻辑就不会触发。 





ViewGroup分发方法（三块代码）

1. 检查是否拦截， 执行拦截方法， 获取是否拦截。
2. 根据是否拦截和是否down事件，进行遍历子view，调用子view的分发方法，把事件分发给子view， 进入子view的分发方法（在没重写分发的情况下， 如果是继承自ViewGroup则重复这个过程，如果是继承自View，则进入View.java的分发方法）。 
3. 根据子view是否消费事件，判断是自己消费事件还是子view消费事件。



第一块代码
// Check for interception.
public boolean dispatchTouchEvent(MotionEvent event) {
if(action==Down){
	resetTouchState() //如果是down事件，重置状态， 会把FLAG_DISALLOW_INTERCEPT重置为初始化状态（允许拦截）
}
final boolean intercepted;
if (actionMasked == MotionEvent.ACTION_DOWN
        || mFirstTouchTarget != null) {
    final boolean disallowIntercept = (mGroupFlags &amp; FLAG_DISALLOW_INTERCEPT) != 0;
    if (!disallowIntercept) {
        intercepted = onInterceptTouchEvent(ev);
        ev.setAction(action); // restore action in case it was changed
    } else {
        intercepted = false;
    }
} else {
    // There are no touch targets and this action is not an initial down
    // so this view group continues to intercept touches.
    intercepted = true;
}





第二块代码 （不拦截，并且是down事件，才执行， 调用 dispatchTransformedTouchEvent来调用子view的分发方法，分发给子view，子view分发方法返回true，则break退出遍历，在这里赋值了newTouchTarget）
if (!canceled &amp;&amp; !intercepted) {
	 if (actionMasked == MotionEvent.ACTION_DOWN) {
	 	 for (int i = childrenCount - 1; i &gt;= 0; i--) {
	 	 if (dispatchTransformedTouchEvent(ev, false, child, idBitsToAssign)) {
                mLastTouchDownX = ev.getX();
                mLastTouchDownY = ev.getY();
                newTouchTarget = addTouchTarget(child, idBitsToAssign);
                alreadyDispatchedToNewTouchTarget = true;
                break;
            }
	 	 }
}
}






第三块代码 （根据第二块代码的子view是否处理，判断自己消费还是子view消费，最后返回ViewGroup.java中这个分发方法的结果为handled）

if (mFirstTouchTarget == null) {
    // No touch targets so treat this as an ordinary view.
    handled = dispatchTransformedTouchEvent(ev, canceled, null,
            TouchTarget.ALL_POINTER_IDS);
} else {
    TouchTarget predecessor = null;
    TouchTarget target = mFirstTouchTarget;
    while (target != null) {
        final TouchTarget next = target.next;
        if (alreadyDispatchedToNewTouchTarget &amp;&amp; target == newTouchTarget) {
            handled = true;
        } else {
            final boolean cancelChild = resetCancelNextUpFlag(target.child)
                    || intercepted;
            if (dispatchTransformedTouchEvent(ev, cancelChild,
                    target.child, target.pointerIdBits)) {
                handled = true;
            }
    }
}

}
</code></pre></div><h3 id="解决事件冲突"><a href="#解决事件冲突" class="header-anchor">#</a> 解决事件冲突</h3> <p>根据事件分发原理，处理事件冲突可以有两种解决思路。</p> <ul><li><p>第一种是：在父view的拦截方法中判断是否拦截，来处理事件交给自身还是子view处理的逻辑</p></li> <li><p>第二种是：父view不拦截，事件都分发到子view，子view调用是否允许父view拦截的方法来控制是否走父view的拦截方法让父view拦截。如果不允许父view拦截，则不会走父view的拦截方法，事件不会被拦截，会分发到子view给子view处理。 如果允许拦截则会走父view的拦截方法，事件被父view拦截，父view自己处理。</p></li></ul> <h4 id="第一种思路代码"><a href="#第一种思路代码" class="header-anchor">#</a> 第一种思路代码</h4> <p>父ViewGroup.java</p> <div class="language- extra-class"><pre class="language-text"><code>    private int mLastPositionX;
    private int mLastPositionY;

    @Override
    public boolean onInterceptTouchEvent(MotionEvent ev) {
        boolean intercept = false;
        int x = (int) ev.getX();
        int y = (int) ev.getY();

        switch (ev.getAction()) {
            case MotionEvent.ACTION_DOWN:
                intercept = false;
                super.onInterceptTouchEvent(ev);
                break;
            case MotionEvent.ACTION_MOVE:
                int deltaX = x - mLastPositionX;
                int deltaY = y - mLastPositionY;

                //这里写父view需要事件条件即可
                 if (Math.abs(deltaX) &gt; Math.abs(deltaY)) {
                    intercept = true;
                } else {
                    intercept = false;
                }
                break;
            case MotionEvent.ACTION_UP:
                intercept = false;
                break;
            default:
                break;
        }

        mLastPositionX = x;
        mLastPositionY = y;

        return intercept;
    }
</code></pre></div><h4 id="第二种思路代码"><a href="#第二种思路代码" class="header-anchor">#</a> 第二种思路代码</h4> <p>父ViewGroup.java</p> <div class="language- extra-class"><pre class="language-text"><code>    @Override
    public boolean onInterceptTouchEvent(MotionEvent ev) {
        boolean intercept = false;
        if (MotionEvent.ACTION_DOWN == ev.getAction()) {
                super.onInterceptTouchEvent(ev);
                return false;
        }
        return true;
    }
</code></pre></div><p>子View.java</p> <div class="language- extra-class"><pre class="language-text"><code>int mLastX,mLastY;
    @Override
    public boolean dispatchTouchEvent(MotionEvent ev) {
        int x = (int) ev.getX();
        int y = (int) ev.getY();

        final int action = ev.getAction() &amp; MotionEvent.ACTION_MASK;
        switch (action) {
            case MotionEvent.ACTION_DOWN:
                getParent().requestDisallowInterceptTouchEvent(true);
                break;
            case MotionEvent.ACTION_MOVE:

                int deltaX = x - mLastX;
                int deltaY = y - mLastY;
                //这里写父view需要事件条件即可
                if (Math.abs(deltaX) &gt; Math.abs(deltaY)){
                    getParent().requestDisallowInterceptTouchEvent(false);
                }
                break;
            case MotionEvent.ACTION_UP:
                break;
            default:
                break;
        }
        mLastX = x;
        mLastY = y;
        return super.dispatchTouchEvent(ev);
    }
</code></pre></div></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">1/9/2024, 11:22:13 AM</span></div></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.75a2606c.js" defer></script><script src="/assets/js/3.7b5fc60a.js" defer></script><script src="/assets/js/1.84786563.js" defer></script><script src="/assets/js/69.141e8266.js" defer></script>
  </body>
</html>
